# GO502A37: Relatório de Transações Suspensas e Ocorrências em Conta Corrente

## Overview

O programa GO502A37 é um sistema de relatórios que processa e apresenta informações sobre transações suspensas e ocorrências em conta corrente do Banco Volkswagen. O programa gera três tipos de arquivos de saída: um relatório detalhado para impressão, um arquivo de dados estruturados para análise e um arquivo para integração com sistemas corporativos (SAP). O sistema processa dados de contratos financeiros, documentos suspensos, e gera resumos por filial e totais gerais, incluindo cálculos de saldos, débitos, créditos e diferentes tipos de movimentações financeiras.

<!-- general-rule-start -->
## Business Rules

### Processamento de Dados de Controle
O programa inicia obtendo a menor data de processamento da tabela PAKF018VCONTROLE onde o status de movimento processado seja diferente de 'N'. Esta data serve como referência para todo o processamento e é utilizada nos títulos dos relatórios e filtros das consultas.

### Seleção de Registros Suspensos
O sistema consulta a tabela PAKF023VSUSPENSO (transações suspensas) em conjunto com PAKF008VCONTRATO (contratos) e PAKF005VCONLOJ (concessionárias/lojas) aplicando os seguintes critérios:
- Data de processamento da suspensão igual à data de controle OU data de regularização igual à data de controle OU status diferente de '1'
- Status deve estar entre 1 e 6
- Situação deve ser diferente de 'C' (cancelado)
- Deve existir relacionamento válido entre contrato e empresa/concessão

### Classificação de Movimentações
O programa classifica as transações em diferentes categorias baseadas nas datas e status:

**Transações Pendentes**: Quando a data de processamento da suspensão é diferente da data de controle e status igual a 1. Estas são contabilizadas no saldo atual.

**Inclusões do Dia**: Quando a data de processamento da suspensão é igual à data de controle e status igual a 1. Se o campo ATNISUSPENSOANT for igual a 1, é uma inclusão normal; caso contrário, é uma transferência.

**Regularizações do Dia**: Quando tanto a data de processamento quanto a data de regularização são iguais à data de controle e status diferente de 1.

**Regularizações Apenas**: Quando apenas a data de regularização é igual à data de controle e status diferente de 1.

### Cálculos de Débito e Crédito
Para determinar se uma transação é débito ou crédito, o sistema verifica o código de lançamento:
- Se código de lançamento estiver entre 999 e 2000: é tratado como débito
- Caso contrário: é tratado como crédito

Para códigos de lançamento entre 1999 e 3000, o valor é apresentado normalmente; para outros códigos, o valor é multiplicado por -1.

### Classificação por Status
O sistema processa diferentes status de transações:
- Status 1: Pendente
- Status 2: Baixa
- Status 3: Regularizado  
- Status 4: Resíduo
- Status 5: Registro Contábil

### Cálculos de Saldos
O programa calcula diversos tipos de saldos e totais:

**Saldo Anterior**: Calculado subtraindo do saldo atual as inclusões, transferências, baixas, exclusões e registros contábeis do dia.

**Saldo Atual**: Soma de todas as transações pendentes (status 1) na data de processamento.

**Saldo da Conta**: Diferença entre créditos e débitos do saldo atual.

### Processamento de Contas Contábeis
O sistema acessa três tipos de contas contábeis baseadas em códigos SAP:
- Código 3412: Para baixas e exclusões
- Código 3413: Para registros contábeis  
- Código 4412: Para inclusões e transferências

### Geração de Lançamentos SAP
Para integração com SAP, o programa gera lançamentos contábeis quando há movimentação:
- Lançamentos de inclusões/transferências (código 4412)
- Lançamentos de baixas/exclusões (código 3412)
- Lançamentos de registros contábeis (código 3413)

Cada lançamento gera um par débito/crédito com as contas apropriadas.

### Verificação de Absorção
O sistema verifica na tabela PAKF074VABSORCAO se existe processo de absorção para a transação suspensa, alterando a descrição para "ABSORÇÃO" quando aplicável.

### Estrutura de Relatórios
O programa gera relatórios estruturados em:
- Cabeçalho com identificação da empresa, filial, data e hora
- Detalhes das transações com todas as informações relevantes
- Resumo por filial com totalizações
- Resumo geral consolidado
- Legenda dos códigos de motivo

### Controle de Paginação
O sistema controla a paginação limitando a 55 linhas por página, gerando novo cabeçalho quando necessário.

### Filtros de Exclusão
Transações com código SAP igual a 4400 são excluídas do processamento.

### Tratamento de Campos Nulos
O programa trata campos nulos (valores negativos retornados do banco) convertendo-os para zeros ou espaços conforme apropriado.
<!-- general-rule-end -->

## Estrutura de Arquivos

### Arquivos de Entrada
- **PAKF018VCONTROLE**: Tabela de controle com datas de processamento
- **PAKF023VSUSPENSO**: Tabela principal de transações suspensas
- **PAKF008VCONTRATO**: Dados dos contratos financeiros
- **PAKF005VCONLOJ**: Informações das concessionárias/lojas
- **PAKG111VLANCTOCON**: Descrições dos códigos de lançamento
- **PAKG002VTIPO**: Descrições dos tipos/motivos
- **PAKF074VABSORCAO**: Controle de processos de absorção

### Arquivos de Saída
- **AD1GO002**: Relatório formatado para impressão (133 caracteres)
- **AB1GO002**: Arquivo de lançamentos SAP (180 caracteres)
- **AB2GO002**: Arquivo de dados estruturados (270 caracteres)
- **AB3GO002**: Arquivo corporativo (300 caracteres)

## Funcionalidades Principais

### Inicialização
- Obtém data de controle da tabela PAKF018VCONTROLE
- Inicializa contadores e totalizadores
- Carrega contas contábeis para os códigos SAP 3412, 3413 e 4412
- Abre cursor para processamento sequencial

### Processamento Principal
- Lê registros do cursor ordenados por filial, contrato e número de suspensão
- Classifica cada transação conforme regras de negócio
- Acumula totalizadores por filial e geral
- Gera detalhes no relatório
- Cria registros para arquivos de saída

### Finalização
- Imprime resumo da última filial processada
- Gera resumo geral consolidado
- Imprime legendas dos códigos
- Gera lançamentos SAP consolidados
- Exibe estatísticas de processamento

## Tratamento de Erros

O programa implementa tratamento robusto de erros SQL, exibindo informações detalhadas sobre:
- Rotina onde ocorreu o erro
- Código SQL retornado
- Função executada (SELECT, OPEN, FETCH, etc.)
- Tabelas envolvidas na operação

Em caso de erro crítico, o programa encerra com código de retorno 26.
# GO502A37: Relatório de Transações Suspensas e Ocorrências em Conta Corrente

## Overview

O programa GO502A37 é um sistema de relatórios que processa e apresenta informações sobre transações suspensas e ocorrências em conta corrente do Banco Volkswagen. O programa gera três tipos de arquivos de saída: um relatório detalhado para impressão, um arquivo de dados estruturados para análise e um arquivo para integração com sistemas corporativos SAP. O sistema processa dados de contratos financeiros, documentos suspensos, e gera resumos por filial e totais gerais, incluindo cálculos de saldos, débitos, créditos e diferentes tipos de movimentações financeiras.

<!-- general-rule-start -->
## Business Rules

### Processamento de Dados de Controle
O programa inicia obtendo a menor data de processamento da tabela PAKF018VCONTROLE onde o status de movimento processado seja diferente de "N". Esta data serve como referência para todo o processamento e é utilizada nos títulos dos relatórios e filtros das consultas.

### Seleção de Registros Suspensos
O sistema consulta a tabela PAKF023VSUSPENSO (transações suspensas) em conjunto com PAKF008VCONTRATO (contratos) e PAKF005VCONLOJ (concessionárias/lojas) aplicando os seguintes critérios:
- Data de processamento da suspenção igual à data de controle OU data de regularização igual à data de controle OU status diferente de 1
- Status deve estar entre 1 e 6
- Situação deve ser diferente de "C" (cancelado)
- Deve existir relacionamento válido entre contrato e empresa/concessão

### Classificação de Movimentações
O programa classifica as transações em diferentes categorias baseadas nas datas e status:

**Transações Pendentes:** Quando a data de processamento da suspenção é diferente da data de controle e status igual a 1. Estas são contabilizadas no saldo atual.

**Inclusões do Dia:** Quando a data de processamento da suspenção é igual à data de controle e status igual a 1. Se o campo ATNISUSPENSOANT for igual a 1, é uma inclusão normal; caso contrário, é uma transferência.

**Regularizações do Dia:** Quando tanto a data de processamento quanto a data de regularização são iguais à data de controle e status diferente de 1.

**Regularizações Apenas:** Quando apenas a data de regularização é igual à data de controle e status diferente de 1.

### Clculos de Débito e Crédito
Para determinar se uma transação é débito ou crédito, o sistema verifica o código de lançamento:
- Se código de lançamento estiver entre 999 e 2000: tratado como débito
- Caso contrário: tratado como crédito
Para códigos de lançamento entre 1999 e 3000, o valor é apresentado normalmente; para outros códigos, o valor é multiplicado por -1.

### Classificação por Status
O sistema processa diferentes status de transações:
- Status 1: Pendente
- Status 2: Baixa
- Status 3: Regularizado
- Status 4: Resíduo
- Status 5: Registro Contábil

### Cálculos de Saldos
O programa calcula diversos tipos de saldos e totais:

**Saldo Anterior:** Calculado subtraindo do saldo atual as inclusões, transferências, baixas, exclusões e registros contábeis do dia.

**Saldo Atual:** Soma de todas as transações pendentes (status 1) na data de processamento.

**Saldo da Conta:** Diferença entre créditos e débitos do saldo atual.

### Processamento de Contas Contábeis
O sistema acessa três tipos de contas contábeis baseadas em códigos SAP:
- Código 3412: Para baixas e exclusões
- Código 3413: Para registros contábeis
- Código 4412: Para inclusões e transferências

### Geração de Lançamentos SAP
Para integração com SAP, o programa gera lançamentos contábeis quando há movimentação:
- Lançamentos de inclusões/transferências (código 4412)
- Lançamentos de baixas/exclusões (código 3412)
- Lançamentos de registros contábeis (código 3413)
Cada lançamento gera um par débito/crédito com as contas apropriadas.

### Verificação de Absorção
O sistema verifica na tabela PAKF074VABSORCAO se existe processo de absorção para a transação suspensa, alterando a descrição para "ABSORÇÃO" quando aplicável.

### Estrutura de Relatórios
O programa gera relatórios estruturados em:
- Cabeçalho com identificação da empresa, filial, data e hora
- Detalhes das transações com todas as informações relevantes
- Resumo por filial com totalizações
- Resumo geral consolidado
- Legenda dos códigos de motivo

### Controle de Paginação
O sistema controla a paginação limitando a 55 linhas por página, gerando novo cabeçalho quando necessário.

### Filtros de Exclusão
Transações com código SAP igual a 4400 são excluídas do processamento.

### Tratamento de Campos Nulos
O programa trata campos nulos (valores negativos retornados do banco) convertendo-os para zeros ou espaços conforme apropriado.
<!-- general-rule-end -->

## Dependencies

O programa GO502A37 possui diversas dependências críticas para seu funcionamento, incluindo tabelas de banco de dados DB2, programas utilitários COBOL, e estruturas de dados específicas do ambiente mainframe. Estas dependências são fundamentais para a operação do sistema e representam pontos importantes a serem considerados durante um processo de modernização.

| Dependency | Description | Type | Reference | Relevance for Modernization |
|------------|-------------|------|-----------|----------------------------|
| AXG1000.PAKF018VCONTROLE | Tabela de controle de processamento que armazena datas de processamento e status de movimentação | Database Table | Schema: AXG1000 | **CRÍTICA** - Tabela principal de controle que define o escopo temporal do processamento |
| AXG1000.PAKF023VSUSPENSO | Tabela principal de transações suspensas contendo todos os dados das suspensões financeiras | Database Table | Schema: AXG1000 | **CRÍTICA** - Fonte primária de dados do relatório |
| AXG1000.PAKF008VCONTRATO | Tabela de contratos financeiros com dados dos clientes e operações | Database Table | Schema: AXG1000 | **CRÍTICA** - Necessária para obter dados complementares dos contratos |
| AXG1000.PAKF005VCONLOJ | Tabela de concessionárias e lojas para identificação das filiais | Database Table | Schema: AXG1000 | **ALTA** - Essencial para agrupamento por filial nos relatórios |
| AXG0201.PAKG111VLANCTOCON | Tabela de configuração de lançamentos contábeis e contas SAP | Database Table | Schema: AXG0201 | **ALTA** - Define mapeamento de contas contábeis para integração SAP |
| AXG0201.PAKG002VTIPO | Tabela de tipos e descrições de motivos de suspensão | Database Table | Schema: AXG0201 | **MÉDIA** - Usada apenas para legendas e descrições |
| AXG1000.PAKF074VABSORCAO | Tabela de controle de processos de absorção de transações | Database Table | Schema: AXG1000 | **MÉDIA** - Funcionalidade específica para identificar absorções |
| YY035A | Programa utilitário COBOL para controle de arquivos de saída | COBOL Program | Biblioteca do sistema | **ALTA** - Gerencia abertura/fechamento de arquivos de relatório |
| YY115A | Programa utilitário COBOL para manipulação de datas e horários | COBOL Program | Biblioteca do sistema | **MÉDIA** - Fornece data/hora atual para cabeçalhos |
| SQLCA | Área de comunicação SQL padrão do DB2 para controle de operações de banco | SQL Include | DB2 System | **CRÍTICA** - Essencial para tratamento de erros SQL |
| GN111V00 | Estrutura de dados COBOL para tabela PAKG111VLANCTOCON | COBOL Copybook | Include library | **ALTA** - Define layout dos dados de lançamentos contábeis |
| GN002V00 | Estrutura de dados COBOL para tabela PAKG002VTIPO | COBOL Copybook | Include library | **MÉDIA** - Define layout dos dados de tipos/motivos |
| GO018V00 | Estrutura de dados COBOL para tabela PAKF018VCONTROLE | COBOL Copybook | Include library | **CRÍTICA** - Define layout da tabela de controle |
| GO008V00 | Estrutura de dados COBOL para tabela PAKF008VCONTRATO | COBOL Copybook | Include library | **CRÍTICA** - Define layout dos dados de contratos |
| GO023V00 | Estrutura de dados COBOL para tabela PAKF023VSUSPENSO | COBOL Copybook | Include library | **CRÍTICA** - Define layout da tabela principal de suspensões |
| GO005V00 | Estrutura de dados COBOL para tabela PAKF005VCONLOJ | COBOL Copybook | Include library | **ALTA** - Define layout dos dados de filiais |
| DB2 Database System | Sistema de gerenciamento de banco de dados IBM DB2 | Database System | IBM DB2 for z/OS | **CRÍTICA** - Plataforma de dados principal do sistema |
| COBOL Runtime | Ambiente de execução COBOL para mainframe | Runtime Environment | IBM Enterprise COBOL | **CRÍTICA** - Necessário para execução do programa |
| JCL Job Control | Sistema de controle de jobs do mainframe para execução batch | Job Control System | z/OS JCL | **ALTA** - Controla a execução do programa em ambiente batch |

## Vulnerabilities

### Vulnerabilidades de Segurança de Dados

**Exposição de Informações Sensíveis:** O programa processa e exibe dados financeiros sensíveis incluindo CPF/CNPJ, valores de contratos, e informações bancárias sem implementar criptografia ou mascaramento adequado. Os dados são gravados em arquivos de texto plano (AD1GO002, AB2GO002) que podem ser acessados por usuários não autorizados.

**Falta de Controle de Acesso:** Não há verificação de permissões de usuário ou controle de acesso baseado em função. Qualquer usuário que consiga executar o programa terá acesso a todas as informações financeiras processadas.

**Log de Informações Sensíveis:** O programa utiliza comandos DISPLAY para exibir informações de debug que podem incluir dados sensíveis como códigos SAP, valores financeiros e identificadores de contratos, criando logs que podem ser explorados.

### Vulnerabilidades de Integridade de Dados

**Tratamento Inadequado de Erros SQL:** Embora o programa tenha tratamento de erros SQL, em alguns casos (como SQLCODE 811 - múltiplas linhas retornadas) o processamento continua sem validação adequada, podendo resultar em dados inconsistentes.

**Ausência de Validação de Dados de Entrada:** O programa não valida adequadamente os dados lidos das tabelas do banco, assumindo que todos os valores são válidos. Campos críticos como valores monetários e datas não passam por validação de integridade.

**Transações Não Atômicas:** As operações de escrita em múltiplos arquivos (AD1GO002, AB1GO002, AB2GO002, AB3GO002) não são tratadas como uma transação atômica, podendo resultar em inconsistências se houver falha durante o processamento.

### Vulnerabilidades de Disponibilidade

**Falta de Controle de Recursos:** O programa não implementa controle de uso de memória ou limites de processamento, podendo consumir recursos excessivos do sistema em caso de grandes volumes de dados.

**Dependência de Recursos Externos:** O programa depende criticamente de programas utilitários (YY035A, YY115A) sem verificar sua disponibilidade antes da execução, podendo falhar de forma inesperada.

**Ausência de Mecanismo de Recovery:** Não há implementação de pontos de controle (checkpoints) ou mecanismos de recuperação em caso de falha durante o processamento de grandes volumes de dados.

### Vulnerabilidades de Configuração

**Hardcoded Values:** O programa contém valores codificados diretamente no código (como códigos SAP 3412, 3413, 4412) que dificultam manutenção e podem causar problemas se estes valores mudarem no ambiente de produção.

**Falta de Parametrização:** Não há arquivo de configuração ou parâmetros externos para controlar comportamentos do programa, tornando necessário recompilar o código para mudanças simples.

**Dependência de Estruturas de Dados Fixas:** O programa assume estruturas de dados fixas definidas nos copybooks, sem flexibilidade para mudanças no esquema do banco de dados.
# GO502A37: Relatório de Transações Suspensas e Ocorrências em Conta Corrente

## Overview
O programa GO502A37 é um sistema de relatórios que processa e apresenta informações sobre transações suspensas e ocorrências em conta corrente do Banco Volkswagen. O programa gera três tipos de arquivos de saída: um relatório detalhado para impressão, um arquivo de dados estruturados para análise e um arquivo para integração com sistemas corporativos SAP. O sistema processa dados de contratos financeiros, documentos suspensos, e gera resumos por filial e totais gerais, incluindo cálculos de saldos, débitos, créditos e diferentes tipos de movimentações financeiras.

<!-- general-rule-start -->
## Business Rules

### Processamento de Dados de Controle
O programa inicia obtendo a menor data de processamento da tabela PAKF018VCONTROLE onde o status de movimento processado seja diferente de "N". Esta data serve como referência para todo o processamento e é utilizada nos títulos dos relatórios e filtros das consultas.

### Seleção de Registros Suspensos
O sistema consulta a tabela PAKF023VSUSPENSO (transações suspensas) em conjunto com PAKF008VCONTRATO (contratos) e PAKF005VCONLOJ (concessionárias/lojas) aplicando os seguintes critérios:
- Data de processamento da suspensão igual à data de controle OU data de regularização igual à data de controle OU status diferente de 1
- Status deve estar entre 1 e 6
- Situação deve ser diferente de "C" (cancelado)
- Deve existir relacionamento válido entre contrato e empresa/concessão

### Classificação de Movimentações
O programa classifica as transações em diferentes categorias baseadas nas datas e status:
**Transações Pendentes:** Quando a data de processamento da suspensão é diferente da data de controle e status igual a 1. Estas são contabilizadas no saldo atual.
**Inclusões do Dia:** Quando a data de processamento da suspensão é igual à data de controle e status igual a 1. Se o campo ATNISUSPENSOANT for igual a 1, é uma inclusão normal; caso contrário, é uma transferência.
**Regularizações do Dia:** Quando tanto a data de processamento quanto a data de regularização são iguais à data de controle e status diferente de 1.
**Regularizações Apenas:** Quando apenas a data de regularização é igual à data de controle e status diferente de 1.

### Clculos de Débito e Crédito
Para determinar se uma transação é débito ou crédito, o sistema verifica o código de lançamento:
- Se código de lançamento estiver entre 999 e 2000: tratado como débito
- Caso contrário: tratado como crédito
Para códigos de lançamento entre 1999 e 3000, o valor é apresentado normalmente; para outros códigos, o valor é multiplicado por -1.

### Classificação por Status
O sistema processa diferentes status de transações:
- Status 1: Pendente
- Status 2: Baixa
- Status 3: Regularizado
- Status 4: Resíduo
- Status 5: Registro Contábil

### Cálculos de Saldos
O programa calcula diversos tipos de saldos e totais:
**Saldo Anterior:** Calculado subtraindo do saldo atual as inclusões, transferências, baixas, exclusões e registros contábeis do dia.
**Saldo Atual:** Soma de todas as transações pendentes (status 1) na data de processamento.
**Saldo da Conta:** Diferença entre créditos e débitos do saldo atual.

### Processamento de Contas Contábeis
O sistema acessa três tipos de contas contábeis baseadas em códigos SAP:
- Código 3412: Para baixas e exclusões
- Código 3413: Para registros contábeis
- Código 4412: Para inclusões e transferências

### Geração de Lançamentos SAP
Para integração com SAP, o programa gera lançamentos contábeis quando há movimentação:
- Lançamentos de inclusões/transferências (código 4412)
- Lançamentos de baixas/exclusões (código 3412)
- Lançamentos de registros contábeis (código 3413)
Cada lançamento gera um par débito/crédito com as contas apropriadas.

### Verificação de Absorção
O sistema verifica na tabela PAKF074VABSORCAO se existe processo de absorção para a transação suspensa, alterando a descrição para "ABSORÇÃO" quando aplicável.

### Estrutura de Relatórios
O programa gera relatórios estruturados em:
- Cabeçalho com identificação da empresa, filial, data e hora
- Detalhes das transações com todas as informações relevantes
- Resumo por filial com totalizações
- Resumo geral consolidado
- Legenda dos códigos de motivo

### Controle de Paginação
O sistema controla a paginação limitando a 55 linhas por página, gerando novo cabeçalho quando necessário.

### Filtros de Exclusão
Transações com código SAP igual a 4400 são excluídas do processamento.

### Tratamento de Campos Nulos
O programa trata campos nulos (valores negativos retornados do banco) convertendo-os para zeros ou espaços conforme apropriado.
<!-- general-rule-end -->

## Dependencies
O programa GO502A37 possui diversas dependências críticas para seu funcionamento, incluindo tabelas de banco de dados DB2, programas utilitários COBOL, e estruturas de dados específicas do ambiente mainframe. Estas dependências são fundamentais para a operação do sistema e representam pontos importantes a serem considerados durante um processo de modernização.

| Dependency | Description | Type | Reference | Relevance for Modernization |
|------------|-------------|------|-----------|----------------------------|
| AXG1000.PAKF018VCONTROLE | Tabela de controle de processamento que armazena datas de processamento e status de movimentação | Database Table | Schema AXG1000 | CRÍTICA - Tabela principal de controle que define o escopo temporal do processamento |
| AXG1000.PAKF023VSUSPENSO | Tabela principal de transações suspensas contendo todos os dados das suspensões financeiras | Database Table | Schema AXG1000 | CRÍTICA - Fonte primária de dados do relatório |
| AXG1000.PAKF008VCONTRATO | Tabela de contratos financeiros com dados dos clientes e operações | Database Table | Schema AXG1000 | CRÍTICA - Necessária para obter dados complementares dos contratos |
| AXG1000.PAKF005VCONLOJ | Tabela de concessionárias e lojas para identificação das filiais | Database Table | Schema AXG1000 | ALTA - Essencial para agrupamento por filial nos relatórios |
| AXG0201.PAKG111VLANCTOCON | Tabela de configuração de lançamentos contábeis e contas SAP | Database Table | Schema AXG0201 | ALTA - Define mapeamento de contas contábeis para integração SAP |
| AXG0201.PAKG002VTIPO | Tabela de tipos e descrições de motivos de suspensão | Database Table | Schema AXG0201 | MÉDIA - Usada apenas para legendas e descrições |
| AXG1000.PAKF074VABSORCAO | Tabela de controle de processos de absorção de transações | Database Table | Schema AXG1000 | MÉDIA - Funcionalidade específica para identificar absorções |
| YY035A | Programa utilitário COBOL para controle de arquivos de saída | COBOL Program | Biblioteca do sistema | ALTA - Gerencia abertura/fechamento de arquivos de relatório |
| YY115A | Programa utilitário COBOL para manipulação de datas e horários | COBOL Program | Biblioteca do sistema | MÉDIA - Fornece data/hora atual para cabeçalhos |
| SQLCA | Área de comunicação SQL padrão do DB2 para controle de operações de banco | SQL Include | DB2 System | CRÍTICA - Essencial para tratamento de erros SQL |

## Detailed Rules

<!-- rule-start -->
**1. Rule/Function/Method Name:** R010INICIALIZA - Inicialização do Sistema

**Detailed Description of the Rule:** Esta função é responsável por inicializar todas as variáveis, abrir arquivos de saída, obter a data de controle do processamento e configurar as contas contábeis necessárias para o processamento.

**What it proposes to do:** Preparar o ambiente de execução do programa, definindo parâmetros iniciais e validando condições necessárias para o processamento principal.

**Rule Status:** Relevante para Modernização

**Algorithm:**
1. Exibir identificação do programa (PROBAID)
2. Abrir arquivos de saída em modo OUTPUT:
   - AD1GO002 (relatório de impressão)
   - AB1GO002 (arquivo SAP)
   - AB2GO002 (arquivo estruturado)
   - AB3GO002 (arquivo corporativo)
3. Chamar programa utilitário YY035A para controle de arquivo AD1GO002
4. Obter data e hora atual:
   - Configurar função 00 no campo GNWKFUNCAO
   - Chamar programa YY115A para obter data/hora sistema
   - Extrair dia, mês, ano, hora e minuto para cabeçalhos
5. Buscar data de controle na tabela PAKF018VCONTROLE:
   - Executar SELECT MIN(PKDTDTPROC) WHERE ATSFMOVPROC <> 'N'
   - Se SQLCODE <> 0 ou resultado < 0: exibir erro e cancelar processamento
   - Converter data obtida para formato de exibição (DD/MM/AAAA)
6. Inicializar estruturas de totalização (WSTOTAIS) com zeros
7. Executar COMMIT para confirmar transações
8. Declarar cursor REGISTRO para seleção principal de dados
9. Abrir cursor REGISTRO
10. Configurar contas contábeis para códigos SAP:
    - Código 3412: buscar contas débito/crédito na tabela PAKG111VLANCTOCON
    - Código 3413: buscar contas débito/crédito na tabela PAKG111VLANCTOCON  
    - Código 4412: buscar contas débito/crédito na tabela PAKG111VLANCTOCON
<!-- rule-end -->

<!-- rule-start -->
**2. Rule/Function/Method Name:** R020PROCESSA - Processamento Principal de Registros

**Detailed Description of the Rule:** Esta função executa o loop principal de processamento, lendo cada registro do cursor e aplicando as regras de classificação e totalização conforme o tipo de movimentação.

**What it proposes to do:** Processar sequencialmente todos os registros de transações suspensas, classificando-os por tipo de operação e acumulando totalizadores.

**Rule Status:** Relevante para Modernização

**Algorithm:**
1. Limpar campos de texto (ATSVDESCRICAOTEXT, ATSVNOMECLITEXT)
2. Executar FETCH no cursor REGISTRO para obter próximo registro
3. Se SQLCODE = 100 (fim de dados):
   - Fechar cursor REGISTRO
   - Definir CHAVEFIM = HIGH-VALUES para encerrar loop
   - Sair da função
4. Se SQLCODE <> 0: exibir erro e cancelar processamento
5. Filtrar registros com ATNICODSAP = 4400 (pular processamento)
6. Incrementar contador CTLIDOS
7. Executar validação de campos (R025VERIFICACAMPOS)
8. Buscar descrição do código de lançamento (R094SELECTLANCTOCON)
9. Buscar descrição do tipo/motivo (R095ACESSATIPO)
10. Controlar quebra por filial:
    - Se filial atual diferente da anterior: imprimir resumo da filial anterior
    - Atualizar filial de controle
11. Classificar tipo de movimentação baseado em datas e status:
    
    **Caso 1 - Transações Pendentes:**
    - Condição: ATDTPROCSUSP <> PKDTDTPROC AND WSATSFSTATUS = 1
    - Ação: Somar 1 ao WSQTDESALDOATU
    - Se código lançamento entre 999 e 2000: somar valor ao WSVLRDEBATU
    - Senão: somar valor ao WSVLRCREDATU
    
    **Caso 2 - Inclusões do Dia:**
    - Condição: ATDTPROCSUSP = PKDTDTPROC AND WSATSFSTATUS = 1
    - Se WSATNISUSPENSOANTNN = 1: classificar como "INCLUÍDO DIA"
    - Senão: classificar como "INCL.TRANSF."
    - Imprimir detalhes (R030IMPRIMEDET)
    - Somar 1 ao WSQTDESALDOATU
    - Aplicar mesma lógica de débito/crédito do Caso 1
    
    **Caso 3 - Regularizações do Dia (Inclusão + Regularização):**
    - Condição: ATDTPROCSUSP = PKDTDTPROC AND ATDTREGULAR = PKDTDTPROC AND WSATSFSTATUS <> 1
    - Verificar absorção (R037VERIFABSORCAO)
    - Imprimir duas linhas de detalhe (inclusão e regularização)
    - Somar 1 ao WSQTDEINCLU
    - Classificar por status final:
      - Status 2: somar ao WSVLRDEBBAIXA/WSVLRCREDBAIXA e WSQTDEBAIXA
      - Status 5: somar ao WSVLRDEBREGCTB/WSVLRCREDREGCTB e WSQTDEREGCTB
      - Outros: somar ao WSVLRDEBEXCL/WSVLRCREDEXCL e WSQTDEEXCL
    
    **Caso 4 - Regularizações Apenas:**
    - Condição: ATDTREGULAR = PKDTDTPROC AND WSATSFSTATUS <> 1
    - Imprimir detalhes da regularização
    - Aplicar mesma classificação por status do Caso 3

12. Gravar registro corporativo (R035GRAVARCORPORATE)
<!-- rule-end -->

<!-- rule-start -->
**3. Rule/Function/Method Name:** R025VERIFICACAMPOS - Validação de Campos Nulos

**Detailed Description of the Rule:** Esta função trata campos que retornam valores negativos (indicadores de NULL) do banco de dados, convertendo-os para valores padrão apropriados.

**What it proposes to do:** Garantir que campos essenciais tenham valores válidos para processamento, evitando erros de cálculo ou exibição.

**Rule Status:** Relevante para Modernização

**Algorithm:**
1. Se WSFKNICONTRATONN < 0: definir FKNICONTRATO = 0
2. Se WSFKNIDOCUMENTONN < 0: definir FKNIDOCUMENTO = 0  
3. Se WSATNDVALORCRNN < 0: definir ATNDVALORCR = 0
4. Se WSFKNDBANCONN < 0: definir FKNDBANCO = 0
5. Se WSFKNICODLANCNN < 0: definir FKNICODLAN
GO502A37 Relatório de Transações Suspensas e Ocorrências em Conta Corrente

## Overview
O programa GO502A37 é um sistema de relatórios que processa e apresenta informações sobre transações suspensas e ocorrências em conta corrente do Banco Volkswagen. O programa gera três tipos de arquivos de saída: um relatório detalhado para impressão, um arquivo de dados estruturados para análise e um arquivo para integração com sistemas corporativos SAP. O sistema processa dados de contratos financeiros, documentos suspensos, e gera resumos por filial e totais gerais, incluindo cálculos de saldos, débitos, créditos e diferentes tipos de movimentações financeiras.

<!-- general-rule-start -->
## Business Rules

### Processamento de Dados de Controle
O programa inicia obtendo a menor data de processamento da tabela PAKF018VCONTROLE onde o status de movimento processado seja diferente de "N". Esta data serve como referência para todo o processamento e é utilizada nos títulos dos relatórios e filtros das consultas.

### Seleção de Registros Suspensos
O sistema consulta a tabela PAKF023VSUSPENSO (transações suspensas) em conjunto com PAKF008VCONTRATO (contratos) e PAKF005VCONLOJ (concessionárias/lojas) aplicando os seguintes critérios:
- Data de processamento da suspenso igual à data de controle OU data de regularização igual à data de controle OU status diferente de 1
- Status deve estar entre 1 e 6
- Situação deve ser diferente de "C" (cancelado)
- Deve existir relacionamento válido entre contrato e empresa/concessão

### Classificação de Movimentações
O programa classifica as transações em diferentes categorias baseadas nas datas e status:
**Transações Pendentes:** Quando a data de processamento da suspenso é diferente da data de controle e status igual a 1. Estas são contabilizadas no saldo atual.
**Inclusões do Dia:** Quando a data de processamento da suspenso é igual à data de controle e status igual a 1. Se o campo ATNISUSPENSOANT for igual a 1, é uma inclusão normal; caso contrário, é uma transferência.
**Regularizações do Dia:** Quando tanto a data de processamento quanto a data de regularização são iguais à data de controle e status diferente de 1.
**Regularizações Apenas:** Quando apenas a data de regularização é igual à data de controle e status diferente de 1.

### Cálculos de Débito e Crédito
Para determinar se uma transação é débito ou crédito, o sistema verifica o código de lançamento:
- Se código de lançamento estiver entre 999 e 2000: tratado como débito
- Caso contrário: tratado como crédito
Para códigos de lançamento entre 1999 e 3000, o valor é apresentado normalmente; para outros códigos, o valor é multiplicado por -1.

### Classificação por Status
O sistema processa diferentes status de transações:
- Status 1: Pendente
- Status 2: Baixa
- Status 3: Regularizado
- Status 4: Resíduo
- Status 5: Registro Contábil

### Cálculos de Saldos
O programa calcula diversos tipos de saldos e totais:
**Saldo Anterior:** Calculado subtraindo do saldo atual as inclusões, transferências, baixas, exclusões e registros contábeis do dia.
**Saldo Atual:** Soma de todas as transações pendentes (status 1) na data de processamento.
**Saldo da Conta:** Diferença entre créditos e débitos do saldo atual.

### Processamento de Contas Contábeis
O sistema acessa três tipos de contas contábeis baseadas em códigos SAP:
- Código 3412: Para baixas e exclusões
- Código 3413: Para registros contábeis
- Código 4412: Para inclusões e transferências

### Geração de Lançamentos SAP
Para integração com SAP, o programa gera lançamentos contábeis quando há movimentação:
- Lançamentos de inclusões/transferências (código 4412)
- Lançamentos de baixas/exclusões (código 3412)
- Lançamentos de registros contábeis (código 3413)
Cada lançamento gera um par débito/crédito com as contas apropriadas.

### Verificação de Absorção
O sistema verifica na tabela PAKF074VABSORCAO se existe processo de absorção para a transação suspensa, alterando a descrição para "ABSORÇÃO" quando aplicável.

### Estrutura de Relatórios
O programa gera relatórios estruturados em:
- Cabeçalho com identificação da empresa, filial, data e hora
- Detalhes das transações com todas as informações relevantes
- Resumo por filial com totalizações
- Resumo geral consolidado
- Legenda dos códigos de motivo

### Controle de Paginação
O sistema controla a paginação limitando a 55 linhas por página, gerando novo cabeçalho quando necessário.

### Filtros de Exclusão
Transações com código SAP igual a 4400 são excluídas do processamento.

### Tratamento de Campos Nulos
O programa trata campos nulos (valores negativos retornados do banco) convertendo-os para zeros ou espaços conforme apropriado.
<!-- general-rule-end -->

## Dependencies
O programa GO502A37 possui diversas dependências críticas para seu funcionamento, incluindo tabelas de banco de dados DB2, programas utilitários COBOL, e estruturas de dados específicas do ambiente mainframe. Estas dependências são fundamentais para a operação do sistema e representam pontos importantes a serem considerados durante um processo de modernização.

| Dependency | Description | Type | Reference | Relevance for Modernization |
|------------|-------------|------|-----------|----------------------------|
| AXG1000.PAKF018VCONTROLE | Tabela de controle de processamento que armazena datas de processamento e status de movimentação | Database Table | Schema AXG1000 | CRÍTICA - Tabela principal de controle que define o escopo temporal do processamento |
| AXG1000.PAKF023VSUSPENSO | Tabela principal de transações suspensas contendo todos os dados das suspensões financeiras | Database Table | Schema AXG1000 | CRÍTICA - Fonte primária de dados do relatório |
| AXG1000.PAKF008VCONTRATO | Tabela de contratos financeiros com dados dos clientes e operações | Database Table | Schema AXG1000 | CRÍTICA - Necessária para obter dados complementares dos contratos |
| AXG1000.PAKF005VCONLOJ | Tabela de concessionárias e lojas para identificação das filiais | Database Table | Schema AXG1000 | ALTA - Essencial para agrupamento por filial nos relatórios |
| AXG0201.PAKG111VLANCTOCON | Tabela de configuração de lançamentos contábeis e contas SAP | Database Table | Schema AXG0201 | ALTA - Define mapeamento de contas contábeis para integração SAP |
| AXG0201.PAKG002VTIPO | Tabela de tipos e descrições de motivos de suspenso | Database Table | Schema AXG0201 | MÉDIA - Usada apenas para legendas e descrições |
| AXG1000.PAKF074VABSORCAO | Tabela de controle de processos de absorção de transações | Database Table | Schema AXG1000 | MÉDIA - Funcionalidade específica para identificar absorções |
| YY035A | Programa utilitário COBOL para controle de arquivos de saída | COBOL Program | Biblioteca do sistema | ALTA - Gerencia abertura/fechamento de arquivos de relatório |
| YY115A | Programa utilitário COBOL para manipulação de datas e horários | COBOL Program | Biblioteca do sistema | MÉDIA - Fornece data/hora atual para cabeçalhos |
| SQLCA | Área de comunicação SQL padrão do DB2 para controle de operações de banco | SQL Include | DB2 System | CRÍTICA - Essencial para tratamento de erros SQL |

## Data Structure
Esta seção descreve em detalhes a estrutura de dados da aplicação, incluindo todas as tabelas, campos de trabalho e estruturas utilizadas pelo programa GO502A37.

| Field ID | Field Name | Data Type | Field Size | Description | Mandatory | Default Value | Additional Notes | Relevant for Modernization | Information Type |
|----------|------------|-----------|------------|-------------|-----------|---------------|------------------|---------------------------|------------------|
| PAKF018V001 | PKDTDTPROC | DATE | 8 | Data de processamento principal que controla o escopo temporal | Sim | - | Formato AAAAMMDD, chave primária | CRÍTICA | Data de Controle |
| PAKF018V002 | ATSFMOVPROC | CHAR | 1 | Status de movimento processado (S/N) | Sim | N | Controla se movimento foi processado | ALTA | Status |
| PAKF023V001 | PKNISUSPENSO | NUMERIC | 9 | Número único identificador da suspenso | Sim | - | Chave primária, sequencial | CRÍTICA | Identificador |
| PAKF023V002 | FKNICONTRATO | NUMERIC | 9 | Número do contrato financeiro relacionado | Sim | - | Chave estrangeira para PAKF008V | CRÍTICA | Relacionamento |
| PAKF023V003 | FKNIDOCUMENTO | NUMERIC | 9 | Número do documento da transação | Não | 0 | Pode ser nulo | MÉDIA | Identificador |
| PAKF023V004 | ATNDVALORCR | DECIMAL | 15,2 | Valor da transação em reais | Sim | 0 | Valor monetário com 2 decimais | CRÍTICA | Valor Financeiro |
| PAKF023V005 | ATDTPAGTO | DATE | 8 | Data de pagamento da transação | Não | - | Formato AAAAMMDD | ALTA | Data |
| PAKF023V006 | ATDTDTCRED | DATE | 8 | Data de crédito da transação | Não | - | Formato AAAAMMDD | ALTA | Data |
| PAKF023V007 | ATDTPROCSUSP | DATE | 8 | Data de processamento da suspenso | Sim | - | Formato AAAAMMDD | CRÍTICA | Data de Controle |
| PAKF023V008 | FKNDBANCO | NUMERIC | 3 | Código do banco | Não | 0 | Código numérico do banco | MÉDIA | Código |
| PAKF023V009 | FKNICODLANC | NUMERIC | 4 | Código do tipo de lançamento | Sim | - | Define débito/crédito | CRÍTICA | Classificação |
| PAKF023V010 | ATNIMOTIVO | NUMERIC | 4 | Código do motivo da suspenso | Sim | - | Chave para tabela de tipos | ALTA | Código |
| PAKF023V011 | ATSFSTATUS | CHAR | 1 | Status atual da transação (1-6) | Sim | 1 | 1=Pendente, 2=Baixa, 3=Regularizado, 4=Resíduo, 5=Reg.Contábil | CRÍTICA | Status |
| PAKF023V012 | ATSFSITUACAO | CHAR | 1 | Situação da transação | Sim | - | C=Cancelado, outros valores ativos | ALTA | Status |
| PAKF023V013 | ATNICODSAP | NUMERIC | 4 | Código SAP para integração contábil | Não | 0 | Usado para mapeamento de contas | CRÍTICA | Integração |
| PAKF023V014 | ATSFUSERID | CHAR | 8 | Identificação do usuário responsável | Não | - | ID do usuário que criou/alterou | MÉDIA | Auditoria |
| PAKF023V015 | ATSFPROGRAMA | CHAR | 8 | Nome do programa que processou | Não | - | Controle de origem | BAIXA | Auditoria |
| PAKF023V016 | ATNICODSAPANT | NUMERIC | 4 | Código SAP anterior | Não | 0 | Para controle de alterações | MÉDIA | Histórico |
| PAKF023V017 | ATSFNOSSONUM | CHAR | 12 | Nosso número bancário | Não | - | Identificação bancária | MÉDIA | Identificador |
| PAKF023V018 | ATNDBANCOARREC | NUMERIC | 3 | Banco arrecadador | Não | 0 | Código do banco arrecadador | BAIXA | Código |
| PAKF023V019 | ATNDAGENCIA | NUMERIC | 5 | Agência bancária | Não | 0 | Código da agência | BAIXA | Código |
| PAKF023V020 | ATSFFORMAPAGTO | CHAR | 8 | Forma de pagamento | Não | - | Tipo de pagamento utilizado | MÉDIA | Classificação |
| PAKF023V021 | ATNISUSPENSOANT | NUMERIC | 9 | Número da suspenso anterior | Não | 0 | Para controle de transferências | ALTA | Relacionamento |
| PAKF023V022 | ATDTREGULAR | DATE | 8 | Data de regularização | Não | - | Formato AAAAMMDD | CRÍTICA | Data de Controle |
| PAKF008V001 | PKNICONTRATO | NUMERIC | 9 | Número do contrato (chave primária) | Sim | - | Identificador único do contrato | CRÍTICA | Identificador |
| PAKF008V002 | FKNDCPFCGC | NUMERIC | 15 | CPF/CNPJ do cliente | Sim | - | Documento do cliente | CRÍTICA | Dados Pessoais |
| PAKF008V003 | FKSFTIPOCLI | CHAR | 1 | Tipo de cliente (F/J) | Sim | - | F=Física, J=Jurídica | ALTA | Classificação |
| PAKF008V004 | ATNISTOPER | NUMERIC | 4 | Status da operação | Não | 0 | Status do contrato | MÉDIA | Status |
| PAKF008V005 | ATDTSTOPER | DATE | 8 | Data do status da operação | Não | - | Data da última alteração de status | MÉDIA | Data |
| PAKF008V006 | ATSFTIPOFIN | CHAR | 3 | Tipo de financiamento | Não | - | Categoria do financiamento | ALTA | Classificação |
| PAKF008V007 | ATSFTPOPER | CHAR | 3 | Tipo de operação | Não | - | Categoria da operação | ALTA | Classificação |
| PAKF008V008 | ATSVNOMECLI | VARCHAR | 60 | Nome do cliente | Sim | - | Nome completo ou razão social | ALTA | Dados Pessoais |
| PAKF008V009 | FKNDEMPRESA | NUMERIC | 3 | Código da empresa | Sim | - | Identificador da empresa | CRÍTICA | Organizacional |
| PAKF008V010 | FKNDCONCESS | NUMERIC | 3 | Código da concessão | Sim | - | Identificador da concess
GO502A37 Relatório de Transações Suspensas e Ocorrências em Conta Corrente

## Overview
O programa GO502A37 é um sistema de relatórios que processa e apresenta informações sobre transações suspensas e ocorrências em conta corrente do Banco Volkswagen. O programa gera três tipos de arquivos de saída: um relatório detalhado para impressão, um arquivo de dados estruturados para análise e um arquivo para integração com sistemas corporativos SAP. O sistema processa dados de contratos financeiros, documentos suspensos, e gera resumos por filial e totais gerais, incluindo cálculos de saldos, débitos, créditos e diferentes tipos de movimentações financeiras.

<!-- general-rule-start -->
## Business Rules

### Processamento de Dados de Controle
O programa inicia obtendo a menor data de processamento da tabela PAKF018VCONTROLE onde o status de movimento processado seja diferente de "N". Esta data serve como referência para todo o processamento e é utilizada nos títulos dos relatórios e filtros das consultas.

### Seleção de Registros Suspensos
O sistema consulta a tabela PAKF023VSUSPENSO (transações suspensas) em conjunto com PAKF008VCONTRATO (contratos) e PAKF005VCONLOJ (concessionárias/lojas) aplicando os seguintes critérios:
- Data de processamento da suspensão igual à data de controle OU data de regularização igual à data de controle OU status diferente de 1
- Status deve estar entre 1 e 6
- Situação deve ser diferente de "C" (cancelado)
- Deve existir relacionamento válido entre contrato e empresa/concessão

### Classificação de Movimentações
O programa classifica as transações em diferentes categorias baseadas nas datas e status:
- **Transações Pendentes**: Quando a data de processamento da suspensão é diferente da data de controle e status igual a 1. Estas são contabilizadas no saldo atual.
- **Inclusões do Dia**: Quando a data de processamento da suspensão é igual à data de controle e status igual a 1. Se o campo ATNISUSPENSOANT for igual a 1, é uma inclusão normal; caso contrário, é uma transferência.
- **Regularizações do Dia**: Quando tanto a data de processamento quanto a data de regularização são iguais à data de controle e status diferente de 1.
- **Regularizações Apenas**: Quando apenas a data de regularização é igual à data de controle e status diferente de 1.

### Cálculos de Débito e Crédito
Para determinar se uma transação é débito ou crédito, o sistema verifica o código de lançamento:
- Se código de lançamento estiver entre 999 e 2000: tratado como débito
- Caso contrário: tratado como crédito
Para códigos de lançamento entre 1999 e 3000, o valor é apresentado normalmente; para outros códigos, o valor é multiplicado por -1.

### Classificação por Status
O sistema processa diferentes status de transações:
- Status 1: Pendente
- Status 2: Baixa
- Status 3: Regularizado
- Status 4: Resíduo
- Status 5: Registro Contábil

### Cálculos de Saldos
O programa calcula diversos tipos de saldos e totais:
- **Saldo Anterior**: Calculado subtraindo do saldo atual as inclusões, transferências, baixas, exclusões e registros contábeis do dia.
- **Saldo Atual**: Soma de todas as transações pendentes (status 1) na data de processamento.
- **Saldo da Conta**: Diferença entre créditos e débitos do saldo atual.

### Processamento de Contas Contábeis
O sistema acessa três tipos de contas contábeis baseadas em códigos SAP:
- Código 3412: Para baixas e exclusões
- Código 3413: Para registros contábeis
- Código 4412: Para inclusões e transferências

### Geração de Lançamentos SAP
Para integração com SAP, o programa gera lançamentos contábeis quando há movimentação:
- Lançamentos de inclusões/transferências (código 4412)
- Lançamentos de baixas/exclusões (código 3412)
- Lançamentos de registros contábeis (código 3413)
Cada lançamento gera um par débito/crédito com as contas apropriadas.

### Verificação de Absorção
O sistema verifica na tabela PAKF074VABSORCAO se existe processo de absorção para a transação suspensa, alterando a descrição para "ABSORÇÃO" quando aplicável.

### Estrutura de Relatórios
O programa gera relatórios estruturados em:
- Cabeçalho com identificação da empresa, filial, data e hora
- Detalhes das transações com todas as informações relevantes
- Resumo por filial com totalizações
- Resumo geral consolidado
- Legenda dos códigos de motivo

### Controle de Paginação
O sistema controla a paginação limitando a 55 linhas por página, gerando novo cabeçalho quando necessário.

### Filtros de Exclusão
Transações com código SAP igual a 4400 são excluídas do processamento.

### Tratamento de Campos Nulos
O programa trata campos nulos (valores negativos retornados do banco) convertendo-os para zeros ou espaços conforme apropriado.
<!-- general-rule-end -->

## Dependencies
O programa GO502A37 possui diversas dependências críticas para seu funcionamento, incluindo tabelas de banco de dados DB2, programas utilitários COBOL, e estruturas de dados específicas do ambiente mainframe. Estas dependências são fundamentais para a operação do sistema e representam pontos importantes a serem considerados durante um processo de modernização.

| Dependency | Description | Type | Reference | Relevance for Modernization |
|------------|-------------|------|-----------|----------------------------|
| AXG1000.PAKF018VCONTROLE | Tabela de controle de processamento que armazena datas de processamento e status de movimentação | Database Table | Schema AXG1000 | CRÍTICA - Tabela principal de controle que define o escopo temporal do processamento |
| AXG1000.PAKF023VSUSPENSO | Tabela principal de transações suspensas contendo todos os dados das suspensões financeiras | Database Table | Schema AXG1000 | CRÍTICA - Fonte primária de dados do relatório |
| AXG1000.PAKF008VCONTRATO | Tabela de contratos financeiros com dados dos clientes e operações | Database Table | Schema AXG1000 | CRÍTICA - Necessária para obter dados complementares dos contratos |
| AXG1000.PAKF005VCONLOJ | Tabela de concessionárias e lojas para identificação das filiais | Database Table | Schema AXG1000 | ALTA - Essencial para agrupamento por filial nos relatórios |
| AXG0201.PAKG111VLANCTOCON | Tabela de configuração de lançamentos contábeis e contas SAP | Database Table | Schema AXG0201 | ALTA - Define mapeamento de contas contábeis para integração SAP |
| AXG0201.PAKG002VTIPO | Tabela de tipos e descrições de motivos de suspensão | Database Table | Schema AXG0201 | MÉDIA - Usada apenas para legendas e descrições |
| AXG1000.PAKF074VABSORCAO | Tabela de controle de processos de absorção de transações | Database Table | Schema AXG1000 | MÉDIA - Funcionalidade específica para identificar absorções |
| YY035A | Programa utilitário COBOL para controle de arquivos de saída | COBOL Program | Biblioteca do sistema | ALTA - Gerencia abertura/fechamento de arquivos de relatório |
| YY115A | Programa utilitário COBOL para manipulação de datas e horários | COBOL Program | Biblioteca do sistema | MÉDIA - Fornece data/hora atual para cabeçalhos |
| SQLCA | Área de comunicação SQL padrão do DB2 para controle de operações de banco | SQL Include | DB2 System | CRÍTICA - Essencial para tratamento de erros SQL |

## Items Relevant for Modernization

Esta seção identifica as funções e métodos do código que são mais relevantes para um cenário de modernização, considerando fatores como complexidade, dependências tecnológicas, impacto no negócio e potencial de melhoria.

### Funções Críticas para Modernização

#### 1. R010INICIALIZA - Inicialização do Sistema
**Relevância**: CRÍTICA
**Motivos**:
- Dependência de programas utilitários mainframe (YY035A, YY115A)
- Lógica de abertura de múltiplos arquivos sequenciais
- Consulta SQL complexa para obtenção da data de controle
- Inicialização de estruturas de dados COBOL específicas
**Impacto na Modernização**: Requer reimplementação completa da lógica de inicialização, substituição dos utilitários por APIs modernas e migração para sistema de arquivos contemporâneo.

#### 2. R020PROCESSA - Loop Principal de Processamento
**Relevância**: CRÍTICA
**Motivos**:
- Contém toda a lógica de negócio principal
- Uso de cursors DB2 com controle manual de fetch
- Múltiplas condições complexas para classificação de transações
- Cálculos financeiros críticos
- Controle de quebra por filial
**Impacto na Modernização**: Núcleo do sistema que deve ser convertido para arquitetura orientada a objetos ou funcional, com implementação de padrões de design modernos.

#### 3. Cálculos de Saldos e Totalizações
**Relevância**: CRÍTICA
**Motivos**:
- Lógica financeira complexa com múltiplas variáveis
- Fórmulas matemáticas específicas para débito/crédito
- Acumuladores distribuídos em várias estruturas
- Impacto direto na precisão dos relatórios financeiros
**Impacto na Modernização**: Requer validação rigorosa e testes extensivos para garantir precisão dos cálculos na nova plataforma.

### Funções de Alta Relevância

#### 4. R030IMPRIMEDET - Formatação de Detalhes
**Relevância**: ALTA
**Motivos**:
- Formatação específica para relatórios de 133 colunas
- Controle de paginação manual
- Múltiplas estruturas de layout fixo
- Dependência de arquivos sequenciais
**Impacto na Modernização**: Oportunidade para implementar geração de relatórios modernos (PDF, Excel, web) com templates flexíveis.

#### 5. R035GRAVARCORPORATE - Geração de Arquivo Corporativo
**Relevância**: ALTA
**Motivos**:
- Interface crítica com sistemas SAP
- Mapeamento complexo de contas contábeis
- Lógica de negócio específica para integração
- Formato de arquivo proprietário
**Impacto na Modernização**: Pode ser substituído por APIs REST ou mensageria para integração com SAP em tempo real.

#### 6. R060IMPRIMERESUMO e R065IMPRIMETOTGER - Geração de Resumos
**Relevância**: ALTA
**Motivos**:
- Cálculos de totalização complexos
- Múltiplas estruturas de dados inter-relacionadas
- Formatação específica para apresentação
- Lógica de quebra de controle
**Impacto na Modernização**: Oportunidade para implementar dashboards interativos e relatórios analíticos modernos.

### Funções de Média Relevância

#### 7. R094SELECTLANCTOCON e R095ACESSATIPO - Consultas de Apoio
**Relevância**: MÉDIA
**Motivos**:
- Consultas SQL simples para busca de descrições
- Tratamento básico de erros
- Funcionalidade de apoio não crítica
**Impacto na Modernização**: Podem ser facilmente convertidas para DAOs ou repositórios modernos.

#### 8. R070IMPRIMELEGENDACAB e R080IMPRIMELEGENDADET - Impressão de Legendas
**Relevância**: MÉDIA
**Motivos**:
- Funcionalidade complementar
- Lógica simples de formatação
- Baixo impacto no negócio
**Impacto na Modernização**: Podem ser eliminadas ou simplificadas em interfaces modernas.

### Estruturas de Dados Relevantes

#### 9. Estruturas de Totalização (WSTOTAIS, WSTOTAISGER)
**Relevância**: CRÍTICA
**Motivos**:
- Contêm todos os acumuladores financeiros
- Estrutura complexa com múltiplos níveis
- Impacto direto na precisão dos cálculos
**Impacto na Modernização**: Devem ser convertidas para classes ou estruturas de dados modernas com validação e encapsulamento.

#### 10. Layouts de Arquivo (WS02REGAB2GO002, REGAB3GO002)
**Relevância**: ALTA
**Motivos**:
- Definem interfaces com sistemas externos
- Formato fixo específico
- Dependência de sistemas legados
**Impacto na Modernização**: Oportunidade para implementar formatos modernos (JSON, XML) ou APIs.

### Recomendações para Modernização

1. **Prioridade 1**: Migrar lógica de negócio principal (R020PROCESSA) para arquitetura moderna
2. **Prioridade 2**: Substituir geração de relatórios por soluções web/mobile
3. **Prioridade 3**: Implementar APIs para integração com SAP
4. **Prioridade 4**: Modernizar acesso a dados com ORMs ou repositórios
5. **Prioridade 5**: Implementar testes automatizados para validação dos cálculos financeiros

## Vulnerabilities

### Vulnerabilidades de Segurança de Dados

#### Exposição de Informações Sensíveis
O programa processa e exibe dados financeiros sensíveis incluindo CPF/CNPJ, valores de contratos, e informações bancárias sem implementar criptografia ou mascaramento adequado. Os dados são gravados em arquivos de texto plano (AD1GO002, AB2GO002) que podem ser acessados por usuários não autorizados.

#### Falta de Controle de Acesso
Não há verificação de permissões de usuário ou controle de acesso baseado em função. Qualquer usuário que consiga executar o programa terá acesso a todas as informações financeiras processadas.

#### Log de Informações Sensíveis
O programa utiliza comandos DISPLAY para exibir informações de debug que podem incluir dados sensíveis como códigos SAP, valores financeiros e identificadores de contratos, criando logs que podem ser explorados.

### Vulnerabilidades de Integridade de Dados

#### Tratamento Inadequado de Erros SQL
Embora o programa tenha tratamento de erros SQL, em alguns casos como SQLCODE = 811 (múltiplas linhas retornadas) o processamento continua sem validação adequada, podendo resultar em dados inconsistentes.

#### Ausência de Validação de Dados de Entrada
O programa não valida adequadamente os dados lidos das tabelas do banco, assumindo que todos os valores são válidos. Campos críticos como valores monetários e datas não passam por validação de integridade.

#### Transações Não Atômicas
As operações de escrita em múltiplos arquivos (AD1GO002, AB1GO002, AB2GO002,
GO502A37 Relatório de Transações Suspensas e Ocorrências em Conta Corrente

## Overview
O programa GO502A37 é um sistema de relatórios que processa e apresenta informações sobre transações suspensas e ocorrências em conta corrente do Banco Volkswagen. O programa gera três tipos de arquivos de saída: um relatório detalhado para impressão, um arquivo de dados estruturados para análise e um arquivo para integração com sistemas corporativos SAP. O sistema processa dados de contratos financeiros, documentos suspensos, e gera resumos por filial e totais gerais, incluindo cálculos de saldos, débitos, créditos e diferentes tipos de movimentações financeiras.

<!-- general-rule-start -->
## Business Rules

### Processamento de Dados de Controle
O programa inicia obtendo a menor data de processamento da tabela PAKF018VCONTROLE onde o status de movimento processado seja diferente de "N". Esta data serve como referência para todo o processamento e é utilizada nos títulos dos relatórios e filtros das consultas.

### Seleção de Registros Suspensos
O sistema consulta a tabela PAKF023VSUSPENSO (transações suspensas) em conjunto com PAKF008VCONTRATO (contratos) e PAKF005VCONLOJ (concessionárias/lojas) aplicando os seguintes critérios:
- Data de processamento da suspensão igual à data de controle OU data de regularização igual à data de controle OU status diferente de 1
- Status deve estar entre 1 e 6
- Situação deve ser diferente de "C" (cancelado)
- Deve existir relacionamento válido entre contrato e empresa/concessão

### Classificação de Movimentações
O programa classifica as transações em diferentes categorias baseadas nas datas e status:
- **Transações Pendentes**: Quando a data de processamento da suspensão é diferente da data de controle e status igual a 1. Estas são contabilizadas no saldo atual.
- **Inclusões do Dia**: Quando a data de processamento da suspensão é igual à data de controle e status igual a 1. Se o campo ATNISUSPENSOANT for igual a 1, é uma inclusão normal; caso contrário, é uma transferência.
- **Regularizações do Dia**: Quando tanto a data de processamento quanto a data de regularização são iguais à data de controle e status diferente de 1.
- **Regularizações Apenas**: Quando apenas a data de regularização é igual à data de controle e status diferente de 1.

### Cálculos de Débito e Crédito
Para determinar se uma transação é débito ou crédito, o sistema verifica o código de lançamento:
- Se código de lançamento estiver entre 999 e 2000: tratado como débito
- Caso contrário: tratado como crédito
Para códigos de lançamento entre 1999 e 3000, o valor é apresentado normalmente; para outros códigos, o valor é multiplicado por -1.

### Classificação por Status
O sistema processa diferentes status de transações:
- Status 1: Pendente
- Status 2: Baixa
- Status 3: Regularizado
- Status 4: Resíduo
- Status 5: Registro Contábil

### Cálculos de Saldos
O programa calcula diversos tipos de saldos e totais:
- **Saldo Anterior**: Calculado subtraindo do saldo atual as inclusões, transferências, baixas, exclusões e registros contábeis do dia.
- **Saldo Atual**: Soma de todas as transações pendentes (status 1) na data de processamento.
- **Saldo da Conta**: Diferença entre créditos e débitos do saldo atual.

### Processamento de Contas Contábeis
O sistema acessa três tipos de contas contábeis baseadas em códigos SAP:
- Código 3412: Para baixas e exclusões
- Código 3413: Para registros contábeis
- Código 4412: Para inclusões e transferências

### Geração de Lançamentos SAP
Para integração com SAP, o programa gera lançamentos contábeis quando há movimentação:
- Lançamentos de inclusões/transferências (código 4412)
- Lançamentos de baixas/exclusões (código 3412)
- Lançamentos de registros contábeis (código 3413)
Cada lançamento gera um par débito/crédito com as contas apropriadas.

### Verificação de Absorção
O sistema verifica na tabela PAKF074VABSORCAO se existe processo de absorção para a transação suspensa, alterando a descrição para "ABSORÇÃO" quando aplicável.

### Estrutura de Relatórios
O programa gera relatórios estruturados em:
- Cabeçalho com identificação da empresa, filial, data e hora
- Detalhes das transações com todas as informações relevantes
- Resumo por filial com totalizações
- Resumo geral consolidado
- Legenda dos códigos de motivo

### Controle de Paginação
O sistema controla a paginação limitando a 55 linhas por página, gerando novo cabeçalho quando necessário.

### Filtros de Exclusão
Transações com código SAP igual a 4400 são excluídas do processamento.

### Tratamento de Campos Nulos
O programa trata campos nulos (valores negativos retornados do banco) convertendo-os para zeros ou espaços conforme apropriado.
<!-- general-rule-end -->

## Dependencies
O programa GO502A37 possui diversas dependências críticas para seu funcionamento, incluindo tabelas de banco de dados DB2, programas utilitários COBOL, e estruturas de dados específicas do ambiente mainframe. Estas dependências são fundamentais para a operação do sistema e representam pontos importantes a serem considerados durante um processo de modernização.

| Dependency | Description | Type | Reference | Relevance for Modernization |
|------------|-------------|------|-----------|----------------------------|
| AXG1000.PAKF018VCONTROLE | Tabela de controle de processamento que armazena datas de processamento e status de movimentação | Database Table | Schema AXG1000 | CRÍTICA - Tabela principal de controle que define o escopo temporal do processamento |
| AXG1000.PAKF023VSUSPENSO | Tabela principal de transações suspensas contendo todos os dados das suspensões financeiras | Database Table | Schema AXG1000 | CRÍTICA - Fonte primária de dados do relatório |
| AXG1000.PAKF008VCONTRATO | Tabela de contratos financeiros com dados dos clientes e operações | Database Table | Schema AXG1000 | CRÍTICA - Necessária para obter dados complementares dos contratos |
| AXG1000.PAKF005VCONLOJ | Tabela de concessionárias e lojas para identificação das filiais | Database Table | Schema AXG1000 | ALTA - Essencial para agrupamento por filial nos relatórios |
| AXG0201.PAKG111VLANCTOCON | Tabela de configuração de lançamentos contábeis e contas SAP | Database Table | Schema AXG0201 | ALTA - Define mapeamento de contas contábeis para integração SAP |
| AXG0201.PAKG002VTIPO | Tabela de tipos e descrições de motivos de suspensão | Database Table | Schema AXG0201 | MÉDIA - Usada apenas para legendas e descrições |
| AXG1000.PAKF074VABSORCAO | Tabela de controle de processos de absorção de transações | Database Table | Schema AXG1000 | MÉDIA - Funcionalidade específica para identificar absorções |
| YY035A | Programa utilitário COBOL para controle de arquivos de saída | COBOL Program | Biblioteca do sistema | ALTA - Gerencia abertura/fechamento de arquivos de relatório |
| YY115A | Programa utilitário COBOL para manipulação de datas e horários | COBOL Program | Biblioteca do sistema | MÉDIA - Fornece data/hora atual para cabeçalhos |
| SQLCA | Área de comunicação SQL padrão do DB2 para controle de operações de banco | SQL Include | DB2 System | CRÍTICA - Essencial para tratamento de erros SQL |

## Items Relevant for Modernization
Esta seção identifica as funções e métodos do código que são mais relevantes para um cenário de modernização, considerando fatores como complexidade, dependências tecnológicas, impacto no negócio e potencial de melhoria.

### Funções Críticas para Modernização

**1. R010INICIALIZA - Inicialização do Sistema**
- Relevância: CRÍTICA
- Motivos:
  - Dependência de programas utilitários mainframe (YY035A, YY115A)
  - Lógica de abertura de múltiplos arquivos sequenciais
  - Consulta SQL complexa para obtenção da data de controle
  - Inicialização de estruturas de dados COBOL específicas
- Impacto na Modernização: Requer reimplementação completa da lógica de inicialização, substituição dos utilitários por APIs modernas e migração para sistema de arquivos contemporâneo.

**2. R020PROCESSA - Loop Principal de Processamento**
- Relevância: CRÍTICA
- Motivos:
  - Contém toda a lógica de negócio principal
  - Uso de cursors DB2 com controle manual de fetch
  - Múltiplas condições complexas para classificação de transações
  - Cálculos financeiros críticos
  - Controle de quebra por filial
- Impacto na Modernização: Núcleo do sistema que deve ser convertido para arquitetura orientada a objetos ou funcional, com implementação de padrões de design modernos.

**3. Cálculos de Saldos e Totalizações**
- Relevância: CRÍTICA
- Motivos:
  - Lógica financeira complexa com múltiplas variáveis
  - Fórmulas matemáticas específicas para débito/crédito
  - Acumuladores distribuídos em várias estruturas
  - Impacto direto na precisão dos relatórios financeiros
- Impacto na Modernização: Requer validação rigorosa e testes extensivos para garantir precisão dos cálculos na nova plataforma.

### Funções de Alta Relevância

**4. R030IMPRIMEDET - Formatação de Detalhes**
- Relevância: ALTA
- Motivos:
  - Formatação específica para relatórios de 133 colunas
  - Controle de paginação manual
  - Múltiplas estruturas de layout fixo
  - Dependência de arquivos sequenciais
- Impacto na Modernização: Oportunidade para implementar geração de relatórios modernos (PDF, Excel, web) com templates flexíveis.

**5. R035GRAVARCORPORATE - Geração de Arquivo Corporativo**
- Relevância: ALTA
- Motivos:
  - Interface crítica com sistemas SAP
  - Mapeamento complexo de contas contábeis
  - Lógica de negócio específica para integração
  - Formato de arquivo proprietário
- Impacto na Modernização: Pode ser substituído por APIs REST ou mensageria para integração com SAP em tempo real.

**6. R060IMPRIMERESUMO e R065IMPRIMETOTGER - Geração de Resumos**
- Relevância: ALTA
- Motivos:
  - Cálculos de totalização complexos
  - Múltiplas estruturas de dados inter-relacionadas
  - Formatação específica para apresentação
  - Lógica de quebra de controle
- Impacto na Modernização: Oportunidade para implementar dashboards interativos e relatórios analíticos modernos.

### Funções de Média Relevância

**7. R094SELECTLANCTOCON e R095ACESSATIPO - Consultas de Apoio**
- Relevância: MÉDIA
- Motivos:
  - Consultas SQL simples para busca de descrições
  - Tratamento básico de erros
  - Funcionalidade de apoio não crítica
- Impacto na Modernização: Podem ser facilmente convertidas para DAOs ou repositórios modernos.

**8. R070IMPRIMELEGENDACAB e R080IMPRIMELEGENDADET - Impressão de Legendas**
- Relevância: MÉDIA
- Motivos:
  - Funcionalidade complementar
  - Lógica simples de formatação
  - Baixo impacto no negócio
- Impacto na Modernização: Podem ser eliminadas ou simplificadas em interfaces modernas.

### Estruturas de Dados Relevantes

**9. Estruturas de Totalização (WSTOTAIS, WSTOTAISGER)**
- Relevância: CRÍTICA
- Motivos:
  - Contém todos os acumuladores financeiros
  - Estrutura complexa com múltiplos níveis
  - Impacto direto na precisão dos cálculos
- Impacto na Modernização: Devem ser convertidas para classes ou estruturas de dados modernas com validação e encapsulamento.

**10. Layouts de Arquivo (WS02REGAB2GO002, REGAB3GO002)**
- Relevância: ALTA
- Motivos:
  - Definem interfaces com sistemas externos
  - Formato fixo específico
  - Dependência de sistemas legados
- Impacto na Modernização: Oportunidade para implementar formatos modernos (JSON, XML) ou APIs.

### Recomendações para Modernização
1. **Prioridade 1**: Migrar lógica de negócio principal (R020PROCESSA) para arquitetura moderna
2. **Prioridade 2**: Substituir geração de relatórios por soluções web/mobile
3. **Prioridade 3**: Implementar APIs para integração com SAP
4. **Prioridade 4**: Modernizar acesso a dados com ORMs ou repositórios
5. **Prioridade 5**: Implementar testes automatizados para validação dos cálculos financeiros

## Items Irrelevant for Modernization
Esta seção identifica as funções e métodos do código que são irrelevantes para um cenário de modernização e podem ser ignorados ou eliminados durante o processo de migração.

### Funções de Formatação Legacy

**1. Controle de Impressão Física**
- **Funções**: R040IMPRIMECAB, controle de CTLIN (contador de linhas)
- **Motivo da Irrelevância**: 
  - Baseado em impressoras de impacto com largura fixa de 133 caracteres
  - Controle manual de quebra de página obsoleto
  - Formatação específica para papel contínuo
- **Alternativa Moderna**: Relatórios web responsivos, PDFs dinâmicos ou dashboards interativos

**2. Estruturas de Layout Fixo para Impressão**
- **Estruturas**: WCAB01, WCAB02, WCAB03, WCAB04, WCAB04A, WDET01, WDET02
- **Motivo da Irrelevância**:
  - Formatação rígida baseada em posições de caractere
  - Dependente de fontes monoespaçadas
  - Não adaptável a diferentes dispositivos ou tamanhos de tela
- **Alternativa Moderna**: Templates HTML/CSS, componentes de UI modernos

**3. Controle de Paginação Manual**
- **Variáveis**: CTPAG, CTLIN, constante 55 (linhas por página)
- **Motivo da Irrelevância**:
  - Conceito obsoleto em interfaces digitais
  -
